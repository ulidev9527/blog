---
title: VirtualBox虚拟机安装Ubuntu22.0.4.server
date: 2023.03.12
update: 
    - 2024.03.12
keywords: 
  - virtual box
  - ubuntu
  - ubuntu 22.0.4
  - 22.0.4
  - 虚拟机
---

# VirtualBox虚拟机安装Ubuntu22.0.4.server

## 核心内容
- `virtualbox` 虚拟机的网络配置
- `ubuntu` 虚拟机系统安装
- `ubuntu` 的网络配置
- `ssh` 登陆

## 准备  
- `macOS | Windows | Linux (没实际使用)`
- [virtualbox 官网下载页](https://www.virtualbox.org/wiki/Downloads)
  - 为什么使用 `virtualBox` ?
    - 使用简单, 系统资源占用少
    - 三平台支持, 转移方便
- [ubuntu 官网下载页](https://ubuntu.com/download/server)
  - 为什么使用 `Ubuntu` ?
    - 习惯了

## 下载  
根据自己系统情况在上面 `下载页` 中下载所需的虚拟机安装包和系统，虚拟机安装包下载后直接安装。  
`Windows` 安装过程中可以直接下一步，直到完成。

## 配置 `Virtualbox`

### 网络配置
- 配置虚拟机和主机之间的局域网
  - 打开 `VirtualBox > 管理 > 工具 > 网络管理器 > 仅主机 (Host-Only) 网络`
  - 选择里面默认的网络
    - `macOS` 直接可以看到配置
    - `windows` 需要 `右键 > 属性` 然后出现网络配置
  - 在属性面板里面修改虚拟机和主机之间的网络
    - **注: 建议用`172.*.*.*`或者`10.*.*.*`**,原因时避免网段冲突。
    - `macOS` 
      - 只需要修改 `最小地址` 和 `最大地址`
      - 例子:
        - 最小地址: `10.123.123.1`
        - 最大地址: `10.123.123.255`
    - `windows` 
      - 需要在 `网卡` 位置修改主机的 `IP`
      - 在 `DHCP服务器` 修改最大/最小地址
  - 修改完成后, 主机的 `IP` 默认是: `10.123.123.1`
- 也可以使用你的局域网 IP，使用局域网 `IP` 这里不需要配置。

## 安装 `Ubuntu`
### 新建虚拟机
- 打开 `VirtualBox > 控制 > 新建`
  - 虚拟电脑名称和系统类型
    — **注: windows 点一下下面的`专家模式`**
    - 名称: 你虚拟机的名称，仅 `VirtualBox` 中显示
    - 文件夹: 建议自己指定一个文件夹
    - 虚拟光盘: 上面步骤下载的 `ISO` 镜像
    - 勾选 `跳过自动安装`
      - 这个功能我没用过,可以自行研究
  - 自动安装
    - 自行研究
  - 硬件
    - 内存: 根据自己电脑情况指定一个虚拟机的内存, 建议: `4G+`
    - 处理器: 同上, 建议: `4+`
    - 启动EFI: 不勾选
  - 虚拟硬盘
    - 硬盘大小: 根据需要自行制定大学，建议 `20G+`
    - 文件类型: 默认
      - 根据需要, 可以直接使用默认的 `VDI`
      - 预先分配全部空间: 不勾选
- 配置完后直接点击完成
- 在 `VirtualBox` 左边列表就出现了你刚才配置名称的虚拟机
### 配置虚拟机
- 列表中 `右键 > 设置 > 网络`
  - `网卡 1` 不用修改
    - 修改后会出现虚拟机无法访问网络的情况，自行决断
  - `网卡 2`
    - 勾选启用网络连接 
    - 连接方式: `仅主机 (Host-Only) 网络`
    - 名称: 上面配置的网络名称
### 启动虚拟机
- 虚拟机的三种启动方式
- **正常启动**: 直接开启虚拟机界面, 界面关闭虚拟机关闭, 适合于即用即关情况。
- **无界面启动**: 后台启动, 没有控制台界面, 适合于已经配置好的系统关机启动
- **分离式启动**: 后台启动, 同时启动一个控制台界面, 界面关闭可以选择后台运行
- 本文选择 **`分离式启动`**
### 安装虚拟系统
- `列表 > 右键 > 启动 > 分离式启动`
- 鼠标点击控制台界面
  - 如果弹出需要捕获鼠标弹框, 选择`捕获`
  - 若是要退出控制台界面
    - `windows` 点击 `键盘右边的 Crtl`
    - `macOS` 点击 `control`
    - 捕获提示中有告诉你怎么退出`捕获状态`
- **注: 下面的每一个同级列代表一个安装系统的选择项配置
- 进入界面后， 默认`Try or Install Ubuntu Server`, 点击回车进入安装流程
  - 这个过程需要等待一定时间
- **语言选择**界面, 默认 `English`, 直接回车
- 是否更新: 默认`Continue without updating`, 直接回车
- 键盘配置: 默认`English` 直接回车
- 安装分类选择: 默认`Ubuntu Server` 直接回车
- 网络配置: 直接回车
- 代理配置: 直接回车
- 镜像配置: 直接回车
- 引导存储配置: 按 `tab`, 高亮显示到最下面的 `Done` 回车
- 存储配置: 直接回车
  - 回车后弹出确认框, 按 `tab`, 高亮显示 `Continue` 回车
- 用户配置: 
  - **注: 按 `tab` 切换输入框**
  - `name / servers name / username` 直接输入用户名即可
  - 两个 `password` 输入密码,后一个是确认密码
  - 名称 / 密码输入完成后, 按 `tab` 高亮下方 `Done`, 回车
- 是否升级到 `Pro` 版, 直接回车
- 配置 `SSH`, **这里要注意了**
  - `Install OpenSSH server` 点击空格勾选(勾选后框里面显示 `X`)
  - 按 `tab`, 高亮到 `Done` 回车
- 选择一些服务
  - 根据需要 按`上下`键勾选，可以直接忽略。
  - `tab` 高亮 `Done` 时 回车
- 等待安装完成, 这里安装需要一定时间, 预计 `10` 分钟内
  - 安装完成后会显示: `Cancel update and reboot` 即可按 `tab` 高亮然后回车重启完成安装
  - 重启等得久可以直接点窗口的 `关闭` 按钮, 选择 `强制退出`
### 重启
- `列表 > 右键 > 启动 > 分离式启动`
  - **注:** 如果上一步时`强制退出`, 需要将 `列表 > 右键 > 设置 > 存储 > 控制器: IDE` 中，如果有 `***.ISO` 光盘需要`右键 > 删除盘片`

- 重启等待`1-2分钟`左右
  - 出现 `Ubuntu 22.04.** LTS <你的用户名> tty1` 的时候代表启动完成
  - 消息可能会被冲突掉, 中途可以多按回车, 出现下面的消息表示成功
    ```
    # 每按一次回车都会出现一个
    <你的用户名> login:
    <你的用户名> login:
    <你的用户名> login:
    <你的用户名> login:
    ```
- 输入账号: `<你的用户名> login: 此处输入用户名` 回车
- 输入密码: 直接输入密码, 回车, 密码验证成功出现 `Welcome to ***` 表示成功进入
### 配置 `root` 密码
- `$ sudo passwd root` 回车
- 输入两次密码，完成 `root` 密码配置
- `$ su` 回车, 输入密码完成提权
### 固定网络`IP`
- `$ ip addr | grep enp` 查看网卡
  - 会出现 `enp0s3` 和 `enp0s8` 两张, 我们需要配置 `enp0s8`
- `$ sudo vi /etc/netplan/00-installer-config.yaml`
  ```yaml
  # This is the network config written by 'subiquity'
  network:
    ethernets:
      enp0s3:
        dhcp4: true
        nameservers:
          addresses: [127.0.0.1]
      # ------- 新加这里 文件时 yaml 格式, 注意结构
      enp0s8:
        addresses:
          - 10.123.123.100/24 # 这里我们固定 IP 为 100, 可以根据自己喜好, 不要用 10.123.123.1, 这是你主机的 IP
      # -------
    version: 2
  ```
  - 修改完成后保存, 不会 `vi` 编辑操作自行搜索相关教程
- `$ sudo netplan apply` 重启网络配置
- `$ ip addr } grep 10.123` 可以看到有一个 `inet 10.123.123.100` 的 `IP`
- 在你主机使用: `$ ping 10.123.123.100` 测试 `ping`

## 主机 `ssh` 登陆
- **注: `windows` 可以先安装 [`git`](https://git-scm.com/downloads), 然后运行 `git-bash` 命令行, 当然也可以直接使用 `PowerShell`**
- `$ ssh 你的用户名@10.123.123.100`
  - 出现 `Are you sure you want to continue connecting (yes/no/[fingerprint])? ` 输入 `yes`
- 输入密码回车, 此时就完成 `ssh` 登陆, 
- 接下来关闭虚拟机的命令行窗口, 点击虚拟机命令行窗口, 出现下面选项
  - 置于后台 **`Continue running in the background`** 选这个
    - 会后台运行, 关闭 `VirtualBox` 不影响
  - 保存当前状态 `Save the machine state`
    - 保存状态, 类似休眠功能, 下次快速启动
  - 发送关机命令 `Send the shutdown signal`
    - 发送关机命令到虚拟机, 让虚拟机自动关机
  - 强制关闭电源 `Power off the machine`
    - 相当于台式电脑直接拔掉电源, 可能会损坏数据(`亲测,血的教训`)

## 完成
上面步骤完成后建议先关机, 然后 `列表右键 > 复制`, 保存一个模版, 下次使用就可以复制一个模版, 避免每次都重新安装, 复制后注意配置`列表右键 > 设置 > 网络` 和虚拟机里面的 `netplan` 的配置